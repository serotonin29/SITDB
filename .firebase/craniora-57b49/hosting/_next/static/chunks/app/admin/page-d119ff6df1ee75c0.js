(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3],{8361:function(e,s,a){Promise.resolve().then(a.bind(a,5358))},5358:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return N}});var t=a(7437),r=a(605),l=a(2265),n=a(9376),i=a(1817),d=a(525),c=a(5805),o=a(8736),x=a(8906),m=a(875),h=a(5053),p=a(3247),u=a(9076),g=a(3340);function j(e){let{search:s,setSearch:a,roleFilter:r,setRoleFilter:l,statusFilter:n,setStatusFilter:i,onReset:d}=e;return(0,t.jsxs)("div",{className:"bg-slate-900 border border-slate-800 p-4 rounded-xl mb-6 space-y-4 md:space-y-0 md:flex md:items-center md:justify-between gap-4",children:[(0,t.jsxs)("div",{className:"relative flex-1 max-w-md",children:[(0,t.jsx)(p.Z,{className:"absolute left-3 top-1/2 -translate-y-1/2 w-4 h-4 text-slate-500"}),(0,t.jsx)("input",{type:"text",placeholder:"Cari nama atau email...",value:s,onChange:e=>a(e.target.value),className:"w-full bg-slate-950 border border-slate-800 rounded-lg pl-10 pr-4 py-2.5 text-sm text-slate-200 placeholder:text-slate-600 focus:outline-none focus:ring-2 focus:ring-blue-500/50"})]}),(0,t.jsxs)("div",{className:"flex items-center gap-3 overflow-x-auto pb-2 md:pb-0",children:[(0,t.jsx)("div",{className:"relative",children:(0,t.jsxs)("select",{value:r,onChange:e=>l(e.target.value),className:"appearance-none bg-slate-950 border border-slate-800 text-slate-300 text-sm rounded-lg pl-4 pr-10 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[(0,t.jsx)("option",{value:"",children:"Semua Peran"}),Object.values(g.UserRole).map(e=>(0,t.jsx)("option",{value:e,children:e.replace("_"," ")},e))]})}),(0,t.jsx)("div",{className:"relative",children:(0,t.jsxs)("select",{value:n,onChange:e=>i(e.target.value),className:"appearance-none bg-slate-950 border border-slate-800 text-slate-300 text-sm rounded-lg pl-4 pr-10 py-2.5 focus:outline-none focus:ring-2 focus:ring-blue-500/50",children:[(0,t.jsx)("option",{value:"",children:"Semua Status"}),Object.values(g.UserStatus).map(e=>(0,t.jsx)("option",{value:e,children:e},e))]})}),(0,t.jsxs)("button",{onClick:d,className:"flex items-center gap-2 px-4 py-2.5 border border-slate-700 rounded-lg text-slate-400 hover:text-white hover:bg-slate-800 transition-colors text-sm font-medium",children:[(0,t.jsx)(u.Z,{className:"w-4 h-4"}),"Reset"]})]})]})}function N(){let{data:e,status:s}=(0,r.useSession)(),a=(0,n.useRouter)(),[p,u]=(0,l.useState)(null),[N,f]=(0,l.useState)([]),[b,v]=(0,l.useState)(!0),[y,w]=(0,l.useState)("overview"),[k,S]=(0,l.useState)(""),[Z,C]=(0,l.useState)(""),[A,R]=(0,l.useState)("");(0,l.useEffect)(()=>{var t;if("unauthenticated"===s){a.push("/login");return}"authenticated"===s&&(null==e?void 0:null===(t=e.user)||void 0===t?void 0:t.role)!=="ADMIN"&&a.push("/dashboard")},[s,e,a]),(0,l.useEffect)(()=>{var s;(null==e?void 0:null===(s=e.user)||void 0===s?void 0:s.role)==="ADMIN"&&T()},[e,Z,A,k]);let T=async()=>{try{let[e,s]=await Promise.all([fetch("/api/admin/stats"),fetch("/api/admin/users?limit=50&role=".concat(Z,"&status=").concat(A,"&search=").concat(k))]),a=await e.json(),t=await s.json();a.success&&u(a.data),t.success&&f(t.data)}catch(e){console.error("Error fetching admin data:",e)}finally{v(!1)}},D=async(e,s)=>{try{let a=await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,role:s})});(await a.json()).success&&(f(N.map(a=>a.id===e?{...a,role:s}:a)),T())}catch(e){console.error("Error updating role:",e)}},E=async(e,s)=>{try{let a=await fetch("/api/admin/users",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({userId:e,status:s})});(await a.json()).success&&(f(N.map(a=>a.id===e?{...a,status:s}:a)),T())}catch(e){console.error("Error updating status:",e)}};return"loading"===s||b?(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(h.Navbar,{}),(0,t.jsx)("div",{className:"flex items-center justify-center h-[60vh]",children:(0,t.jsx)(i.Z,{className:"w-8 h-8 animate-spin text-primary-500"})})]}):(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(h.Navbar,{}),(0,t.jsxs)("main",{className:"max-w-7xl mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900",children:"Admin Panel"}),(0,t.jsx)("p",{className:"text-gray-600",children:"Kelola sistem SITDB"})]}),(0,t.jsxs)("div",{className:"flex gap-4 mb-6",children:[(0,t.jsxs)("button",{onClick:()=>w("overview"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("overview"===y?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[(0,t.jsx)(d.Z,{className:"w-4 h-4 inline mr-2"}),"Overview"]}),(0,t.jsxs)("button",{onClick:()=>w("users"),className:"px-4 py-2 rounded-lg font-medium transition-colors ".concat("users"===y?"bg-primary-500 text-white":"bg-white text-gray-600 hover:bg-gray-100"),children:[(0,t.jsx)(c.Z,{className:"w-4 h-4 inline mr-2"}),"Pengguna"]})]}),"overview"===y&&p&&(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Total Laporan"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:p.totalReports})]}),(0,t.jsx)("div",{className:"p-3 bg-primary-100 rounded-full",children:(0,t.jsx)(o.Z,{className:"w-6 h-6 text-primary-600"})})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Total Pengguna"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:p.totalUsers})]}),(0,t.jsx)("div",{className:"p-3 bg-blue-100 rounded-full",children:(0,t.jsx)(c.Z,{className:"w-6 h-6 text-blue-600"})})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Total Relawan"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-gray-900",children:p.totalRelawan})]}),(0,t.jsx)("div",{className:"p-3 bg-green-100 rounded-full",children:(0,t.jsx)(x.Z,{className:"w-6 h-6 text-green-600"})})]})}),(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:"Menunggu"}),(0,t.jsx)("p",{className:"text-3xl font-bold text-warning-600",children:p.pendingReports})]}),(0,t.jsx)("div",{className:"p-3 bg-warning-100 rounded-full",children:(0,t.jsx)(d.Z,{className:"w-6 h-6 text-warning-600"})})]})})]}),(0,t.jsxs)("div",{className:"grid md:grid-cols-2 gap-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Laporan per Jenis"}),(0,t.jsx)("div",{className:"space-y-3",children:Object.entries(p.reportsByType).map(e=>{let[s,a]=e;return(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-24 text-sm text-gray-600",children:s}),(0,t.jsx)("div",{className:"flex-1 bg-gray-100 rounded-full h-4",children:(0,t.jsx)("div",{className:"bg-primary-500 h-4 rounded-full",style:{width:"".concat(a/p.totalReports*100,"%")}})}),(0,t.jsx)("div",{className:"w-8 text-sm text-gray-900 font-medium",children:a})]},s)})})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm p-6 border border-gray-100",children:[(0,t.jsx)("h3",{className:"font-semibold text-gray-900 mb-4",children:"Laporan per Tingkat"}),(0,t.jsx)("div",{className:"space-y-3",children:Object.entries(p.reportsBySeverity).map(e=>{let[s,a]=e;return(0,t.jsxs)("div",{className:"flex items-center gap-3",children:[(0,t.jsx)("div",{className:"w-24 text-sm text-gray-600",children:s}),(0,t.jsx)("div",{className:"flex-1 bg-gray-100 rounded-full h-4",children:(0,t.jsx)("div",{className:"h-4 rounded-full ".concat({RINGAN:"bg-green-500",SEDANG:"bg-yellow-500",BERAT:"bg-orange-500",KRITIS:"bg-red-500"}[s]||"bg-gray-500"),style:{width:"".concat(a/p.totalReports*100,"%")}})}),(0,t.jsx)("div",{className:"w-8 text-sm text-gray-900 font-medium",children:a})]},s)})})]})]})]}),"users"===y&&(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100",children:[(0,t.jsx)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-4",children:(0,t.jsx)(j,{search:k,setSearch:S,roleFilter:Z,setRoleFilter:C,statusFilter:A,setStatusFilter:R,onReset:()=>{S(""),C(""),R("")}})}),(0,t.jsx)("div",{className:"overflow-x-auto",children:(0,t.jsxs)("table",{className:"w-full",children:[(0,t.jsx)("thead",{className:"bg-gray-50",children:(0,t.jsxs)("tr",{children:[(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Pengguna"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Role"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Status"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Laporan"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Terdaftar"}),(0,t.jsx)("th",{className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Aksi"})]})}),(0,t.jsx)("tbody",{className:"divide-y divide-gray-100",children:N.map(e=>(0,t.jsxs)("tr",{className:"hover:bg-gray-50",children:[(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsxs)("div",{children:[(0,t.jsx)("p",{className:"font-medium text-gray-900",children:e.name}),(0,t.jsx)("p",{className:"text-sm text-gray-500",children:e.email})]})}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsx)("span",{className:"px-2 py-1 rounded text-xs font-medium ".concat("ADMIN"===e.role?"bg-purple-100 text-purple-800":"RELAWAN"===e.role?"bg-green-100 text-green-800":"bg-gray-100 text-gray-800"),children:e.role})}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsx)("div",{className:"relative",children:(0,t.jsx)("select",{value:e.status,onChange:s=>E(e.id,s.target.value),className:"appearance-none rounded px-2 py-1 pr-6 text-xs font-medium border-0 focus:ring-2 focus:ring-primary-500 cursor-pointer ".concat("ACTIVE"===e.status?"bg-green-100 text-green-800":"PENDING"===e.status?"bg-yellow-100 text-yellow-800":"REJECTED"===e.status?"bg-red-100 text-red-800":"bg-gray-100 text-gray-800"),children:Object.values(g.UserStatus).map(e=>(0,t.jsx)("option",{value:e,children:e},e))})})}),(0,t.jsxs)("td",{className:"px-4 py-4 text-sm text-gray-600",children:[e._count.reports," laporan"]}),(0,t.jsx)("td",{className:"px-4 py-4 text-sm text-gray-600",children:new Date(e.createdAt).toLocaleDateString("id-ID")}),(0,t.jsx)("td",{className:"px-4 py-4",children:(0,t.jsxs)("div",{className:"relative",children:[(0,t.jsxs)("select",{value:e.role,onChange:s=>D(e.id,s.target.value),className:"appearance-none bg-white border border-gray-300 rounded px-3 py-1 pr-8 text-sm focus:ring-2 focus:ring-primary-500 focus:border-transparent",children:[(0,t.jsx)("option",{value:"MASYARAKAT",children:"Masyarakat"}),(0,t.jsx)("option",{value:"RELAWAN",children:"Relawan"}),(0,t.jsx)("option",{value:"ADMIN",children:"Admin"})]}),(0,t.jsx)(m.Z,{className:"absolute right-2 top-1/2 -translate-y-1/2 w-4 h-4 text-gray-400 pointer-events-none"})]})})]},e.id))})]})}),0===N.length&&(0,t.jsx)("div",{className:"p-8 text-center text-gray-500",children:"Tidak ada pengguna ditemukan"})]})]})]})}},5053:function(e,s,a){"use strict";a.d(s,{Navbar:function(){return g}});var t=a(7437),r=a(7648),l=a(605),n=a(2265),i=a(6865),d=a(3774),c=a(5466),o=a(5805),x=a(7692),m=a(9090),h=a(7806),p=a(2489),u=a(8293);function g(){var e,s,a,g,j;let{data:N,status:f}=(0,l.useSession)(),[b,v]=(0,n.useState)(!1),y=(null==N?void 0:null===(e=N.user)||void 0===e?void 0:e.role)==="ADMIN";return null==N||null===(s=N.user)||void 0===s||s.role,(0,t.jsxs)("nav",{className:"bg-gradient-to-r from-primary-600 to-primary-800 text-white shadow-lg sticky top-0 z-50",children:[(0,t.jsx)("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:(0,t.jsxs)("div",{className:"flex justify-between h-16",children:[(0,t.jsx)("div",{className:"flex items-center",children:(0,t.jsxs)(r.default,{href:"/",className:"flex items-center space-x-2",children:[(0,t.jsx)(i.Z,{className:"h-8 w-8 text-warning-400"}),(0,t.jsx)("span",{className:"text-xl font-bold",children:"SITDB"})]})}),(0,t.jsxs)("div",{className:"hidden md:flex items-center space-x-4",children:[(0,t.jsxs)(r.default,{href:"/map",className:"flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-white/10 transition-colors",children:[(0,t.jsx)(d.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Peta"})]}),N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.default,{href:"/dashboard",className:"flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-white/10 transition-colors",children:[(0,t.jsx)(c.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Dashboard"})]}),(0,t.jsxs)(r.default,{href:"/reports/new",className:"flex items-center space-x-1 px-3 py-2 bg-warning-500 hover:bg-warning-600 rounded-md transition-colors font-semibold",children:[(0,t.jsx)(i.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Laporkan"})]}),y&&(0,t.jsxs)(r.default,{href:"/admin",className:"flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-white/10 transition-colors",children:[(0,t.jsx)(o.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Admin"})]})]}),"loading"===f?(0,t.jsx)("div",{className:"w-8 h-8 rounded-full bg-white/20 animate-pulse"}):N?(0,t.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,t.jsxs)("div",{className:"text-sm",children:[(0,t.jsx)("p",{className:"font-semibold",children:null===(a=N.user)||void 0===a?void 0:a.name}),(0,t.jsx)("p",{className:"text-xs text-white/70 capitalize",children:null===(j=N.user)||void 0===j?void 0:null===(g=j.role)||void 0===g?void 0:g.toLowerCase()})]}),(0,t.jsx)("button",{onClick:()=>(0,l.signOut)({callbackUrl:"/"}),className:"p-2 rounded-md hover:bg-white/10 transition-colors",title:"Keluar",children:(0,t.jsx)(x.Z,{className:"h-5 w-5"})})]}):(0,t.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,t.jsxs)(r.default,{href:"/login",className:"flex items-center space-x-1 px-3 py-2 rounded-md hover:bg-white/10 transition-colors",children:[(0,t.jsx)(m.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Masuk"})]}),(0,t.jsxs)(r.default,{href:"/register",className:"flex items-center space-x-1 px-3 py-2 bg-white text-primary-600 rounded-md hover:bg-white/90 transition-colors font-semibold",children:[(0,t.jsx)(h.Z,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:"Daftar"})]})]})]}),(0,t.jsx)("div",{className:"md:hidden flex items-center",children:(0,t.jsx)("button",{onClick:()=>v(!b),className:"p-2 rounded-md hover:bg-white/10 transition-colors",children:b?(0,t.jsx)(p.Z,{className:"h-6 w-6"}):(0,t.jsx)(u.Z,{className:"h-6 w-6"})})})]})}),b&&(0,t.jsx)("div",{className:"md:hidden bg-primary-700 border-t border-white/10",children:(0,t.jsxs)("div",{className:"px-4 py-3 space-y-2",children:[(0,t.jsxs)(r.default,{href:"/map",className:"flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-white/10 transition-colors",onClick:()=>v(!1),children:[(0,t.jsx)(d.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Peta Bencana"})]}),N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.default,{href:"/dashboard",className:"flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-white/10 transition-colors",onClick:()=>v(!1),children:[(0,t.jsx)(c.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Dashboard"})]}),(0,t.jsxs)(r.default,{href:"/reports/new",className:"flex items-center space-x-2 px-3 py-2 bg-warning-500 rounded-md transition-colors",onClick:()=>v(!1),children:[(0,t.jsx)(i.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Laporkan Bencana"})]}),y&&(0,t.jsxs)(r.default,{href:"/admin",className:"flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-white/10 transition-colors",onClick:()=>v(!1),children:[(0,t.jsx)(o.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Admin Panel"})]}),(0,t.jsxs)("button",{onClick:()=>{v(!1),(0,l.signOut)({callbackUrl:"/"})},className:"flex items-center space-x-2 px-3 py-2 w-full text-left rounded-md hover:bg-white/10 transition-colors text-red-300",children:[(0,t.jsx)(x.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Keluar"})]})]}),!N&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsxs)(r.default,{href:"/login",className:"flex items-center space-x-2 px-3 py-2 rounded-md hover:bg-white/10 transition-colors",onClick:()=>v(!1),children:[(0,t.jsx)(m.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Masuk"})]}),(0,t.jsxs)(r.default,{href:"/register",className:"flex items-center space-x-2 px-3 py-2 bg-white text-primary-600 rounded-md transition-colors",onClick:()=>v(!1),children:[(0,t.jsx)(h.Z,{className:"h-5 w-5"}),(0,t.jsx)("span",{children:"Daftar"})]})]})]})})]})}}},function(e){e.O(0,[976,605,694,971,117,744],function(){return e(e.s=8361)}),_N_E=e.O()}]);