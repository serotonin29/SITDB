(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[697],{3612:function(e,s,a){Promise.resolve().then(a.bind(a,6492))},1671:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},1723:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]])},8906:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]])},2369:function(e,s,a){"use strict";a.d(s,{Z:function(){return t}});let t=(0,a(9205).Z)("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]])},6492:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return Z}});var t=a(7437),r=a(605),l=a(2265),i=a(9376),n=a(7648),c=a(166),d=a(1671),o=a(1723),m=a(9205);let x=(0,m.Z)("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);var u=a(1817),h=a(6865);let g=(0,m.Z)("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);var y=a(2369),p=a(3774);let b=(0,m.Z)("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);var N=a(5053);let f=(0,m.Z)("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var j=a(8906);let v=(0,m.Z)("CircleCheck",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m9 12 2 2 4-4",key:"dzmm74"}]]),w={PENDING:{icon:(0,t.jsx)(f,{className:"w-4 h-4"}),color:"text-gray-500",bgColor:"bg-gray-100"},VERIFIED:{icon:(0,t.jsx)(j.Z,{className:"w-4 h-4"}),color:"text-blue-500",bgColor:"bg-blue-100"},IN_PROGRESS:{icon:(0,t.jsx)(o.Z,{className:"w-4 h-4"}),color:"text-yellow-500",bgColor:"bg-yellow-100"},RESOLVED:{icon:(0,t.jsx)(v,{className:"w-4 h-4"}),color:"text-green-500",bgColor:"bg-green-100"},REJECTED:{icon:(0,t.jsx)(x,{className:"w-4 h-4"}),color:"text-red-500",bgColor:"bg-red-100"}},E={PENDING:"Menunggu Verifikasi",VERIFIED:"Terverifikasi",IN_PROGRESS:"Sedang Ditangani",RESOLVED:"Selesai",REJECTED:"Ditolak"},k={MASYARAKAT:"Pelapor",RELAWAN:"Relawan",ADMIN:"Admin"};function S(e){let{history:s}=e;return s&&0!==s.length?(0,t.jsx)("div",{className:"flow-root",children:(0,t.jsx)("ul",{className:"-mb-8",children:s.map((e,a)=>{let r=w[e.status]||w.PENDING,l=a===s.length-1,i=new Date(e.createdAt);return(0,t.jsx)("li",{children:(0,t.jsxs)("div",{className:"relative pb-8",children:[!l&&(0,t.jsx)("span",{className:"absolute top-4 left-4 -ml-px h-full w-0.5 bg-gray-200","aria-hidden":"true"}),(0,t.jsxs)("div",{className:"relative flex space-x-3",children:[(0,t.jsx)("div",{children:(0,t.jsx)("span",{className:"h-8 w-8 rounded-full flex items-center justify-center ring-4 ring-white ".concat(r.bgColor," ").concat(r.color),children:r.icon})}),(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsx)("p",{className:"text-sm font-medium text-gray-900",children:E[e.status]}),(0,t.jsx)("time",{className:"text-xs text-gray-500",children:i.toLocaleDateString("id-ID",{day:"numeric",month:"short",hour:"2-digit",minute:"2-digit"})})]}),(0,t.jsxs)("p",{className:"text-xs text-gray-500 mt-0.5",children:["oleh ",(0,t.jsx)("span",{className:"font-medium",children:e.user.name}),(0,t.jsx)("span",{className:"ml-1 px-1.5 py-0.5 rounded text-xs ".concat("ADMIN"===e.user.role?"bg-purple-100 text-purple-700":"RELAWAN"===e.user.role?"bg-blue-100 text-blue-700":"bg-gray-100 text-gray-700"),children:k[e.user.role]})]}),e.notes&&(0,t.jsx)("div",{className:"mt-2 p-2 bg-gray-50 rounded-lg",children:(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.notes})})]})]})]})},e.id)})})}):(0,t.jsxs)("div",{className:"text-center py-8 text-gray-500",children:[(0,t.jsx)(f,{className:"w-8 h-8 mx-auto mb-2 opacity-50"}),(0,t.jsx)("p",{children:"Belum ada riwayat status"})]})}let D=(0,c.default)(()=>Promise.all([a.e(212),a.e(703)]).then(a.bind(a,703)),{loadableGenerated:{webpack:()=>[703]},ssr:!1,loading:()=>(0,t.jsx)("div",{className:"h-[200px] bg-gray-100 rounded-lg animate-pulse"})}),R={RINGAN:"bg-green-100 text-green-800 border-green-300",SEDANG:"bg-yellow-100 text-yellow-800 border-yellow-300",BERAT:"bg-orange-100 text-orange-800 border-orange-300",KRITIS:"bg-red-100 text-red-800 border-red-300"},C={PENDING:"bg-gray-100 text-gray-800",VERIFIED:"bg-blue-100 text-blue-800",IN_PROGRESS:"bg-yellow-100 text-yellow-800",RESOLVED:"bg-green-100 text-green-800",REJECTED:"bg-red-100 text-red-800"},I=[{value:"VERIFIED",label:"Terverifikasi",icon:d.Z,color:"text-blue-600"},{value:"IN_PROGRESS",label:"Sedang Ditangani",icon:o.Z,color:"text-yellow-600"},{value:"RESOLVED",label:"Selesai",icon:d.Z,color:"text-green-600"},{value:"REJECTED",label:"Ditolak",icon:x,color:"text-red-600"}];function Z(){var e,s;let{data:a,status:c}=(0,r.useSession)(),d=(0,i.useRouter)(),m=(0,i.useParams)(),[x,f]=(0,l.useState)(null),[j,v]=(0,l.useState)(!0),[w,E]=(0,l.useState)(!1),[k,Z]=(0,l.useState)({status:"",notes:""});(0,l.useEffect)(()=>{"unauthenticated"===c&&d.push("/login")},[c,d]),(0,l.useEffect)(()=>{(null==a?void 0:a.user)&&m.id&&A()},[a,m.id]);let A=async()=>{try{let e=await fetch("/api/reports/".concat(m.id)),s=await e.json();s.success&&f(s.data)}catch(e){console.error("Error fetching report:",e)}finally{v(!1)}},L=async e=>{if(e.preventDefault(),k.status){E(!0);try{let e=await fetch("/api/reports/".concat(m.id,"/status"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(k)});(await e.json()).success&&(A(),Z({status:"",notes:""}))}catch(e){console.error("Error updating status:",e)}finally{E(!1)}}};if("loading"===c||j)return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(N.Navbar,{}),(0,t.jsx)("div",{className:"flex items-center justify-center h-[60vh]",children:(0,t.jsx)(u.Z,{className:"w-8 h-8 animate-spin text-primary-500"})})]});if(!x)return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(N.Navbar,{}),(0,t.jsxs)("div",{className:"flex flex-col items-center justify-center h-[60vh]",children:[(0,t.jsx)(h.Z,{className:"w-12 h-12 text-gray-300 mb-4"}),(0,t.jsx)("p",{className:"text-gray-500",children:"Laporan tidak ditemukan"}),(0,t.jsx)(n.default,{href:"/dashboard",className:"text-primary-600 hover:underline mt-2",children:"Kembali ke Dashboard"})]})]});let P=(null==a?void 0:null===(e=a.user)||void 0===e?void 0:e.role)==="ADMIN"||(null==a?void 0:null===(s=a.user)||void 0===s?void 0:s.role)==="RELAWAN",O=new Date(x.createdAt).toLocaleDateString("id-ID",{weekday:"long",day:"numeric",month:"long",year:"numeric",hour:"2-digit",minute:"2-digit"});return(0,t.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,t.jsx)(N.Navbar,{}),(0,t.jsxs)("main",{className:"max-w-5xl mx-auto px-4 py-8",children:[(0,t.jsxs)(n.default,{href:"/dashboard",className:"inline-flex items-center gap-2 text-gray-600 hover:text-gray-900 mb-6",children:[(0,t.jsx)(g,{className:"w-4 h-4"}),"Kembali"]}),(0,t.jsxs)("div",{className:"grid lg:grid-cols-3 gap-6",children:[(0,t.jsxs)("div",{className:"lg:col-span-2 space-y-6",children:[(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,t.jsxs)("div",{className:"flex items-start justify-between mb-4",children:[(0,t.jsxs)("div",{children:[(0,t.jsx)("span",{className:"text-sm text-gray-500 uppercase tracking-wide",children:x.type.replace("_"," ")}),(0,t.jsx)("h1",{className:"text-2xl font-bold text-gray-900 mt-1",children:x.title})]}),(0,t.jsx)("span",{className:"px-3 py-1 rounded-full text-sm font-medium ".concat(C[x.status]),children:x.status.replace("_"," ")})]}),(0,t.jsxs)("div",{className:"flex flex-wrap gap-4 text-sm text-gray-600 mb-4",children:[(0,t.jsx)("span",{className:"px-2 py-1 rounded border ".concat(R[x.severity]),children:x.severity}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(o.Z,{className:"w-4 h-4"}),O]}),(0,t.jsxs)("span",{className:"flex items-center gap-1",children:[(0,t.jsx)(y.Z,{className:"w-4 h-4"}),x.user.name]})]}),(0,t.jsx)("p",{className:"text-gray-700 whitespace-pre-wrap",children:x.description}),x.address&&(0,t.jsxs)("div",{className:"mt-4 flex items-start gap-2 text-gray-600",children:[(0,t.jsx)(p.Z,{className:"w-4 h-4 mt-0.5 shrink-0"}),(0,t.jsx)("span",{className:"text-sm",children:x.address})]})]}),(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,t.jsx)("h2",{className:"font-semibold text-gray-900 mb-4",children:"Lokasi Bencana"}),(0,t.jsx)(D,{markers:[{id:x.id,latitude:x.latitude,longitude:x.longitude,type:x.type,severity:x.severity,status:x.status,title:x.title}],center:[x.latitude,x.longitude],zoom:14,className:"h-[300px]"})]}),P&&(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6",children:[(0,t.jsx)("h2",{className:"font-semibold text-gray-900 mb-4",children:"Update Status"}),(0,t.jsxs)("form",{onSubmit:L,className:"space-y-4",children:[(0,t.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-2",children:I.map(e=>(0,t.jsxs)("button",{type:"button",onClick:()=>Z(s=>({...s,status:e.value})),className:"p-3 rounded-lg border-2 transition-all text-sm font-medium flex items-center gap-2 ".concat(k.status===e.value?"border-primary-500 bg-primary-50":"border-gray-200 hover:border-gray-300"),children:[(0,t.jsx)(e.icon,{className:"w-4 h-4 ".concat(e.color)}),e.label]},e.value))}),(0,t.jsx)("textarea",{value:k.notes,onChange:e=>Z(s=>({...s,notes:e.target.value})),placeholder:"Catatan tambahan (opsional)",rows:3,className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary-500 focus:border-transparent resize-none"}),(0,t.jsxs)("button",{type:"submit",disabled:!k.status||w,className:"w-full bg-primary-500 hover:bg-primary-600 text-white py-3 rounded-lg font-medium transition-colors disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-2",children:[w?(0,t.jsx)(u.Z,{className:"w-5 h-5 animate-spin"}):(0,t.jsx)(b,{className:"w-5 h-5"}),"Update Status"]})]})]})]}),(0,t.jsx)("div",{className:"lg:col-span-1",children:(0,t.jsxs)("div",{className:"bg-white rounded-xl shadow-sm border border-gray-100 p-6 sticky top-24",children:[(0,t.jsx)("h2",{className:"font-semibold text-gray-900 mb-4",children:"Riwayat Status"}),(0,t.jsx)(S,{history:x.statusHistory})]})})]})]})]})}}},function(e){e.O(0,[976,605,240,971,117,744],function(){return e(e.s=3612)}),_N_E=e.O()}]);